---
domain: make.cape.io # This is the cache CNAME used for the virtual server on the compile server. CNAME that domain to cache.cape.io and it will serve the compiled website.
uid: 1 # The CAPE user ID to use for authenticating against the providers when requesting API resources. This needs to be updated to the correct uid.
cape_version: 2.2.1

load:
  - "/_api/gh_content/_load.json"
  - "/_api/gh_theme/_load.json"
  - "/_view/_all/_output"

api: # An API is a set of default information. Think of an API as a collection of content.
  gh_content: # Used to get content from github.
    provider: github
    arg:
      owner: sundaysenergy
      repo: make.cape.io
      branch: master
    field:
      _dirname: true

  gh_theme: # Used to get content from github.
    provider: github
    filter:
      must:
        _dirname: cape
    arg:
      owner: sundaysenergy
      repo: templates.cape.io
      branch: gh-pages
    load:
      arg:
        sha: gh-pages
    without: _dirname

  github_hook:
    provider: github
    load:
      _id: after
    arg:
      name: update_hook

model:

view:
  documentation:
    type: string
    file_id: 'index.html'
    field:
      data: true
      readme: true
    template:
      model: template
      _id: default.mustache
      partial:
        page_html:
          model: template # Load same way as you load a template.
          _id: readme.html

  index_html:
    type: string
    file_id: 'make_files/index.html'
    field:
      data: true # when value is true use key as the model_id and just get its data.
      make_files:
        model: make_files
        emit:
          link: 'http://make.cape.io/make_files/{{_filename}}.json'# link to json file
          edit: 'https://github.com/sundaysenergy/make.cape.io/edit/master/{{&_id}}'
    template:
      model: template
      _id: default.mustache
      partial:
        page_html:
          model: template # Load same way as you load a template.
          _id: make_index.html

  index_json:
    type: list
    field:
      make_files: true
    pager:
      iterate: make_files
      field_id: make
    emit: '{{make._filename}}' # similar to processing a template.
    output_id: index.json # This should move to /make_files/

